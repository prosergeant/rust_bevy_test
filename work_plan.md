# План работ по улучшению игры "Flappy Bird"

Цель: Добавить полноценное меню и исправить ошибку с бесконечным созданием труб при выходе из паузы.

## 1. Рефакторинг состояний игры (`GameState`)

-   **Проблема:** Текущее использование `GameState::Playing` для создания игровых объектов вызывает их повторное создание при выходе из паузы.
-   **Задача:** Разделить состояние "начала игры" и "игрового процесса".
-   **Шаги:**
    1.  Добавить новое состояние `PreGame` в `src/states/game_state.rs`. Это состояние будет использоваться для инициализации новой игры.
    2.  Переименовать состояние `Menu` в `MainMenu` для большей ясности.

## 2. Обновление логики спавна объектов

-   **Проблема:** Птица и трубы создаются при входе в состояние `Playing`.
-   **Задача:** Перенести логику создания в новое состояние `PreGame`.
-   **Шаги:**
    1.  В `src/plugins/bird.rs`, изменить систему `spawn_bird`, чтобы она срабатывала при входе в `OnEnter(GameState::PreGame)`.
    2.  В `src/plugins/pipes.rs`, изменить систему `spawn_pipes`, чтобы она также срабатывала при входе в `OnEnter(GameState::PreGame)`.
    3.  Создать новую систему, которая будет автоматически переводить игру из состояния `PreGame` в `Playing` сразу после создания всех объектов.

## 3. Реализация главного меню (`MainMenu`)

-   **Задача:** Создать визуальное представление для главного меню и экрана "Game Over".
-   **Шаги:**
    1.  Создать компонент `OnMainMenuScreen` для элементов UI, которые должны отображаться только в главном меню.
    2.  Создать систему, которая при входе в `OnEnter(GameState::MainMenu)` будет отображать на экране текст, например: "Flappy Bird" и "Нажмите Пробел, чтобы начать".
    3.  Добавить систему, которая при выходе из `OnExit(GameState::MainMenu)` будет удалять все элементы с компонентом `OnMainMenuScreen`.

## 4. Реализация экрана "Game Over"

-   **Задача:** Улучшить экран завершения игры.
-   **Шаги:**
    1.  Создать компонент `OnGameOverScreen` для UI элементов экрана "Game Over".
    2.  Создать систему, которая при входе в `OnEnter(GameState::GameOver)` будет отображать счет и инструкцию для перезапуска ("Нажмите Пробел, чтобы вернуться в меню").
    3.  Добавить систему, которая при выходе из `OnExit(GameState::GameOver)` будет удалять все элементы с компонентом `OnGameOverScreen`.

## 5. Корректировка системы переходов между состояниями

-   **Задача:** Обеспечить правильную логику переходов между всеми состояниями игры.
-   **Шаги:**
    1.  В `src/core/systems.rs`, обновить систему `transition_to_game_state`, чтобы она обрабатывала следующие переходы:
        -   `MainMenu` -> `PreGame` (по нажатию `Space`)
        -   `GameOver` -> `MainMenu` (по нажатию `Space`)
    2.  Убедиться, что логика паузы (`Playing` <-> `Paused` по нажатию `Escape`) работает корректно и не вызывает повторного создания объектов.
    3.  Удалить старую логику перехода из `Menu` в `Playing`.
