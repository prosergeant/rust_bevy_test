# План разработки: Бесконечный спавн труб

## Текущая проблема
В игре спавнится только 3 трубы при входе в состояние `PreGame`. После прохождения этих труб новые не появляются, что ограничивает геймплей.

## Цель
Реализовать бесконечный спавн труб, чтобы игра продолжалась до столкновения с препятствием.

## План реализации

### Этап 1: Анализ текущей системы
- [x] Изучить текущий код спавна труб в `pipes.rs:31-75`
- [x] Понять логику движения труб в `pipes.rs:77-81`
- [x] Изучить систему подсчета очков в `pipes.rs:108-122`

### Этап 2: Создание системы бесконечного спавна
- [ ] Добавить таймер для контроля интервала спавна новых труб
- [ ] Создать систему `spawn_pipes_continuously`, которая будет работать в состоянии `Playing`
- [ ] Реализовать проверку необходимости спавна новой трубы
- [ ] Добавить новую систему в `PipesPlugin`

### Этап 3: Оптимизация производительности
- [ ] Добавить систему удаления труб, которые вышли за пределы экрана
- [ ] Реализовать пуллинг объектов для оптимизации памяти
- [ ] Настроить оптимальное расстояние между трубами

### Этап 4: Тестирование и балансировка
- [ ] Протестировать бесконечный спавн труб
- [ ] Настроить сложность игры (расстояние между трубами, скорость движения)
- [ ] Проверить корректность работы системы подсчета очков

## Технические детали

### Новые компоненты
```rust
#[derive(Component)]
pub struct PipeSpawner {
    timer: Timer,
    last_pipe_x: f32,
}
```

### Новые системы
1. `spawn_pipes_continuously` - непрерывный спавн труб
2. `cleanup_offscreen_pipes` - удаление труб за экраном
3. `update_pipe_spawner` - обновление состояния спавнера

### Константы для настройки
```rust
const PIPE_SPAWN_INTERVAL: f32 = 2.0; // секунды между спавном
const PIPE_DISTANCE: f32 = 400.0; // расстояние между трубами
const OFFSCREEN_THRESHOLD: f32 = -200.0; // порог для удаления труб
```

## Интеграция с существующим кодом
- Сохранить текущую систему движения труб
- Интегрировать новую систему спавна с существующими состояниями игры
- Обеспечить совместимость с системой подсчета очков

## Ожидаемый результат
Бесконечный геймплей с постоянным появлением новых труб, позволяющий игроку набирать очки без ограничений по времени.

## Статус реализации ✅
План полностью реализован:

- [x] Добавлен ресурс `PipeSpawner` с таймером для контроля спавна
- [x] Создана система `spawn_pipes_continuously` для бесконечного спавна труб
- [x] Реализована система `cleanup_offscreen_pipes` для удаления труб за экраном
- [x] Все системы интегрированы в `PipesPlugin`
- [x] Игра успешно скомпилирована и запущена

## Технические детали реализации

### Новые константы
```rust
const PIPE_SPAWN_INTERVAL: f32 = 2.0;    // Интервал спавна труб
const PIPE_DISTANCE: f32 = 400.0;        // Расстояние между трубами
const OFFSCREEN_THRESHOLD: f32 = -200.0; // Порог удаления труб
```

### Ресурс PipeSpawner
```rust
#[derive(Resource)]
pub struct PipeSpawner {
    pub timer: Timer,        // Таймер для контроля спавна
    pub last_pipe_x: f32,     // Позиция последней трубы
}
```

### Ключевые системы
- `spawn_pipes_continuously`: Спавнит новые трубы каждые 2 секунды
- `cleanup_offscreen_pipes`: Удаляет трубы при выходе за экран
- `spawn_pipe_pair`: Универсальная функция для создания пары труб