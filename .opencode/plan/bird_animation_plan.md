# План разработки: Анимация птицы Flappy Bird

## 1. Обзор архитектуры проекта

### 1.1 Текущие плагины и их роль
- **BirdPlugin**: Управление физикой птицы, спавн, движение, прыжки
- **AssetLoaderPlugin**: Загрузка игровых ассетов (текстуры, звуки, шрифты)
- **GamePlugin**: Основной плагин с системами UI и управления состояниями

### 1.2 Ключевые компоненты
- **Bird**: Физика и скорость птицы
- **Transform**: Позиция, вращение, масштаб
- **Texture**: Текущий спрайт птицы

### 1.3 Основные ресурсы
- **GameAssets**: Хранилище хендлов ассетов
- **GameScore**: Система подсчёта очков
- **GameState**: Управление состояниями игры

### 1.4 Порядок регистрации плагинов
```rust
App::new()
    .add_plugins(AssetLoaderPlugin)  // Сначала загрузка ассетов
    .add_plugins(BirdPlugin)         // Потом игровые механики
    .add_plugins(GamePlugin)         // Основные системы и UI
```

---

## 2. Приоритеты реализации

### 2.1 Приоритет 1 - Базовая анимация (1-2 дня)
**Цель**: Создать плавную анимацию махания крыльями
- Расширить загрузку ассетов для поддержки нескольких кадров
- Добавить компонент состояния анимации
- Реализовать систему переключения кадров

### 2.2 Приоритет 2 - Оптимизация анимации (опционально)
**Цель**: Улучшить производительность и визуальное качество
- Переход на атлас текстур
- Адаптивная скорость анимации
- Интеграция с физикой

---

## 3. Технические шаги для каждого пункта

### 3.1 Расширение системы ассетов

#### 3.1.1 Модификация GameAssets ресурса
- Заменить `bird_texture: Handle<Image>` на `bird_textures: Vec<Handle<Image>>`
- Добавить поле для индексации кадров

#### 3.1.2 Обновление AssetLoaderPlugin
- Загружать 3 текстуры: bird_up.png, bird_mid.png, bird_down.png
- Проверить успешность загрузки всех кадров

#### 3.1.3 Создание файлов ассетов
- Подготовить 3 кадра анимации (50x50px каждый)
- Разместить в директории `assets/textures/`

### 3.2 Добавление компонентов анимации

#### 3.2.1 Создание BirdAnimation компонента
- Добавить поле `timer: Timer` для контроля времени кадра
- Добавить поле `current_frame: usize` для отслеживания кадра
- Добавить поле `state: BirdAnimationState` для контекстной анимации

#### 3.2.2 Создание BirdAnimationState enum
- `Idle`: Состояние покоя (медленная анимация)
- `Flapping`: Активное махание (быстрая анимация)
- `Falling`: Падение (замедленная анимация)

### 3.3 Реализация систем анимации

#### 3.3.1 Система animate_bird
- Обновлять таймер анимации
- Переключать кадры на основе состояния и времени
- Менять текстуру спрайта в зависимости от текущего кадра

#### 3.3.2 Интеграция с существующими системами
- Модифицировать `bird_movement` для определения состояния анимации
- Интегрировать систему в BirdPlugin с правильным состоянием игры

#### 3.3.3 Система spawn_bird
- Инициализировать BirdAnimation компонент при спавне
- Установить начальный кадр и состояние

### 3.4 Тестирование и полировка

#### 3.4.1 Проверка производительности
- Мониторинг FPS при анимации
- Проверка памяти при загрузке множественных текстур

#### 3.4.2 Валидация визуального качества
- Плавность переходов между кадрами
- Правильная синхронизация с физикой движения

---

## 4. Структура файлов проекта

### 4.1 Модифицируемые файлы
```
src/
├── core/
│   └── resources.rs          # Изменить GameAssets структуру
├── plugins/
│   ├── bird.rs              # Добавить компоненты и системы анимации
│   └── asset_loader.rs      # Расширить загрузку текстур
└── assets/
    └── textures/
        ├── bird_up.png      # НОВЫЙ кадр 1
        ├── bird_mid.png     # НОВЫЙ кадр 2
        └── bird_down.png    # НОВЫЙ кадр 3
```

### 4.2 Новые компоненты и системы
- `BirdAnimation`: Компонент состояния анимации
- `BirdAnimationState`: Enum для контекстной анимации
- `animate_bird`: Система обновления кадров
- Модифицированные: `spawn_bird`, `bird_movement`

---

## 5. Метрики качества

### 5.1 Технические метрики
- Поддерживать 60 FPS с анимацией
- Время загрузки ассетов < 100мс
- Использование памяти +10MB для дополнительных текстур

### 5.2 Метрики пользовательского опыта
- Плавность анимации (60 кадров в секунду)
- Отсутствие видимых артефактов переключения кадров
- Синхронизация анимации с физикой движения

---

## 6. Ограничения на детализацию

### 6.1 Уровень архитектуры
- План фокусируется на компонентах и системах Bevy ECS
- Избегает детальной имплементации алгоритмов
- Концентрируется на взаимодействии между модулями

### 6.2 Техническая реализация
- Описывает какие структуры данных нужны, но не их поля
- Указывает названия систем без детальной логики
- Фокусируется на интеграции с существующей архитектурой

### 6.3 Цель и результат каждого шага
- Каждый пункт имеет чёткую цель (например: "Создать плавную анимацию")
- Результат измеряем (например: "60 FPS с анимацией")
- Приоритеты основаны на влиянии на игровой опыт